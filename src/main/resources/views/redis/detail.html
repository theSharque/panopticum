<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::main})}">
<head></head>
<body>
<main th:fragment="main" class="main-content">
    <div th:replace="~{fragments/breadcrumbs :: breadcrumbs(items=${breadcrumbs})}"></div>
    <p th:if="${error}" th:text="${msg != null && msg[error] != null ? msg[error] : error}" class="query-error"></p>
    <h1 th:text="${msg['redis.keyDetailTitle']}">Key</h1>
    <div th:if="${keyDetail != null}" class="query-result-data">
        <dl class="detail-dl">
            <dt><span th:text="${msg['redis.key']}">Key</span> : <span th:text="${keyDetail.key}" class="query-cell-mono"></span></dt>
            <dt><span th:text="${msg['common.type']}">Type</span> : <span th:text="${keyDetail.type}"></span></dt>
            <dt><span th:text="${msg['redis.ttl']}">TTL</span> : <span th:text="${keyDetail.ttl != null ? keyDetail.ttl + ' ms' : msg['redis.noExpiry']}"></span></dt>
        </dl>
        <h2 th:text="${msg['common.value']}">Value</h2>
        <div th:if="${keyDetail.type == 'string'}" class="detail-value">
            <form th:action="@{/redis/{id}/{dbIndex}/detail(id=${connectionId}, dbIndex=${dbIndex})}" method="post" class="detail-form">
                <input type="hidden" name="key" th:value="${keyDetail.key}"/>
                <input type="hidden" name="type" th:value="${keyDetail.type}"/>
                <textarea name="value" class="detail-json detail-json-textarea" th:text="${keyDetail.value}"></textarea>
                <div class="detail-actions">
                    <button type="submit" id="redis-save-btn" class="query-button" th:text="${msg['common.save']}">Save</button>
                </div>
            </form>
        </div>
        <div th:if="${keyDetail.type == 'hash' and keyDetail.value != null}" class="detail-value">
            <form th:action="@{/redis/{id}/{dbIndex}/detail(id=${connectionId}, dbIndex=${dbIndex})}" method="post" class="detail-form">
                <input type="hidden" name="key" th:value="${keyDetail.key}"/>
                <input type="hidden" name="type" th:value="${keyDetail.type}"/>
                <table class="query-table">
                    <thead>
                        <tr><th class="query-th" th:text="${msg['common.field']}">Field</th><th class="query-th" th:text="${msg['common.value']}">Value</th></tr>
                    </thead>
                    <tbody>
                        <tr th:each="entry : ${keyDetail.value}">
                            <td><input type="hidden" name="fieldKeys" th:value="${entry.key}"/><span class="query-cell-mono" th:text="${entry.key}"></span></td>
                            <td><input type="text" name="fieldValues" th:value="${entry.value}" class="query-cell-mono detail-edit-input"/></td>
                        </tr>
                    </tbody>
                </table>
                <div class="detail-actions">
                    <button type="submit" id="redis-save-btn" class="query-button" th:text="${msg['common.save']}">Save</button>
                </div>
            </form>
        </div>
        <div th:if="${(keyDetail.type == 'list' or keyDetail.type == 'set') and keyDetail.value != null}" class="detail-value">
            <ul class="detail-list">
                <li th:each="elem : ${keyDetail.value}" th:text="${elem}" class="query-cell-mono"></li>
            </ul>
        </div>
        <div th:if="${keyDetail.type == 'zset' and keyDetail.value != null}" class="detail-value">
            <table class="query-table">
                <thead>
                    <tr><th class="query-th" th:text="${msg['common.element']}">Element</th><th class="query-th" th:text="${msg['common.score']}">Score</th></tr>
                </thead>
                <tbody>
                    <tr th:each="sv : ${keyDetail.value}">
                        <td th:text="${sv.value}" class="query-cell-mono"></td>
                        <td th:text="${sv.score}" class="query-cell-mono"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <p th:if="${keyDetail == null}" class="text-dim" th:text="${msg['redis.keyNotFoundOrError']}">Key not found or connection error.</p>
</main>
</body>
</html>
